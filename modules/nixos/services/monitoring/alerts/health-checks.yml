groups:
  - name: zfs_health
    rules:
      - alert: ZFSPoolDegraded
        expr: zfs_pool_state < 1
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "ZFS pool {{ $labels.pool }} is degraded or faulted"
          description: "ZFS pool {{ $labels.pool }} has state {{ $value }} (1=ONLINE, 0.5=DEGRADED, 0=FAULTED) for more than 5 minutes."

      - alert: ZFSPoolHighUsage
        expr: (zfs_pool_used_bytes / zfs_pool_capacity_bytes) * 100 > 85
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: "ZFS pool {{ $labels.pool }} usage is high"
          description: "ZFS pool {{ $labels.pool }} is {{ $value }}% full."

      - alert: ZFSPoolCriticalUsage
        expr: (zfs_pool_used_bytes / zfs_pool_capacity_bytes) * 100 > 95
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "ZFS pool {{ $labels.pool }} usage is critical"
          description: "ZFS pool {{ $labels.pool }} is {{ $value }}% full."

      - alert: ZFSScrubErrors
        expr: zfs_scrub_errors > 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "ZFS scrub found errors on pool {{ $labels.pool }}"
          description: "ZFS scrub found {{ $value }} errors on pool {{ $labels.pool }}."

      - alert: ZFSScrubOld
        expr: (time() - zfs_scrub_last_timestamp) > (30 * 24 * 60 * 60)
        for: 1h
        labels:
          severity: warning
        annotations:
          summary: "ZFS scrub is overdue for pool {{ $labels.pool }}"
          description: "ZFS pool {{ $labels.pool }} has not been scrubbed for {{ $value }} seconds."

  - name: smart_health
    rules:
      - alert: SMARTDeviceFailure
        expr: smartctl_device_smart_healthy != 1
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "SMART indicates device {{ $labels.device }} is failing"
          description: "SMART health check failed for device {{ $labels.device }}."

      - alert: SMARTDeviceHighTemperature
        expr: smartctl_device_temperature > 60
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: "High temperature on device {{ $labels.device }}"
          description: "Device {{ $labels.device }} temperature is {{ $value }}Â°C."

      - alert: SMARTDeviceReallocatedSectors
        expr: increase(smartctl_device_reallocated_sector_count[1h]) > 0
        for: 1m
        labels:
          severity: warning
        annotations:
          summary: "Reallocated sectors detected on {{ $labels.device }}"
          description: "Device {{ $labels.device }} has reallocated {{ $value }} sectors in the last hour."